<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GramFrame - File Protocol Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 20px;
      margin: 0;
      background: #f5f5f5;
    }
    
    h1 {
      color: #333;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }
    
    .test-info {
      background: #e7f3ff;
      border: 1px solid #b8d4f0;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    
    .component-container {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    
    .component-container h2 {
      margin-top: 0;
      color: #555;
    }
    
    table.gram-config {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    table.gram-config th,
    table.gram-config td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    
    table.gram-config th {
      background-color: #f2f2f2;
    }

    .success {
      color: green;
      font-weight: bold;
    }
    
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>GramFrame - File Protocol Compatibility Test</h1>
  
  <div class="test-info">
    <h3>Test Information</h3>
    <p><strong>Purpose:</strong> This page tests GramFrame functionality when opened directly from the file system (file:// protocol).</p>
    <p><strong>Status:</strong> <span id="load-status">Loading...</span></p>
    <p><strong>JavaScript Bundle:</strong> <span id="bundle-status">Not loaded</span></p>
  </div>
  
  <div class="component-container">
    <h2>Component Instance 1 - Analysis Mode</h2>
    
    <!-- Sample config table that will be replaced by the component -->
    <table class="gram-config">
      <tr>
        <td colspan="2">
          <img src="./sample/mock-gram.png" alt="Sample Spectrogram">
        </td>
      </tr>
      <tr>
        <td>time-start</td>
        <td>0</td>
      </tr>
      <tr>
        <td>time-end</td>
        <td>60</td>
      </tr>
      <tr>
        <td>freq-start</td>
        <td>0</td>
      </tr>
      <tr>
        <td>freq-end</td>
        <td>100</td>
      </tr>
    </table>
  </div>

  <div class="component-container">
    <h2>Component Instance 2 - Harmonics Mode</h2>
    
    <!-- Second instance with different parameters -->
    <table class="gram-config">
      <tr>
        <td colspan="2">
          <img src="./sample/mock-gram.png" alt="Sample Spectrogram">
        </td>
      </tr>
      <tr>
        <td>time-start</td>
        <td>10</td>
      </tr>
      <tr>
        <td>time-end</td>
        <td>50</td>
      </tr>
      <tr>
        <td>freq-start</td>
        <td>20</td>
      </tr>
      <tr>
        <td>freq-end</td>
        <td>80</td>
      </tr>
      <tr>
        <td>mode</td>
        <td>harmonics</td>
      </tr>
    </table>
  </div>

  <div class="component-container">
    <h2>Component Instance 3 - Doppler Mode</h2>
    
    <!-- Third instance for doppler testing -->
    <table class="gram-config">
      <tr>
        <td colspan="2">
          <img src="./sample/mock-gram.png" alt="Sample Spectrogram">
        </td>
      </tr>
      <tr>
        <td>time-start</td>
        <td>5</td>
      </tr>
      <tr>
        <td>time-end</td>
        <td>45</td>
      </tr>
      <tr>
        <td>freq-start</td>
        <td>10</td>
      </tr>
      <tr>
        <td>freq-end</td>
        <td>90</td>
      </tr>
      <tr>
        <td>mode</td>
        <td>doppler</td>
      </tr>
    </table>
  </div>

  <!-- Load the standalone IIFE bundle -->
  <script src="./dist/gramframe.bundle.js"></script>

  <script>
    // Test script to verify functionality
    document.addEventListener('DOMContentLoaded', () => {
      const loadStatus = document.getElementById('load-status')
      const bundleStatus = document.getElementById('bundle-status')
      
      // Check if GramFrame loaded
      if (typeof window.GramFrame !== 'undefined') {
        bundleStatus.textContent = 'Loaded successfully'
        bundleStatus.className = 'success'
        
        // Wait a moment for components to initialize
        setTimeout(() => {
          const components = document.querySelectorAll('.gram-frame-container')
          if (components.length > 0) {
            loadStatus.textContent = `Successfully initialized ${components.length} component(s)`
            loadStatus.className = 'success'
          } else {
            loadStatus.textContent = 'Bundle loaded but components not initialized'
            loadStatus.className = 'error'
          }
        }, 1000)
        
        // Add state listener to monitor functionality
        if (window.GramFrame.addStateListener) {
          window.GramFrame.addStateListener((state) => {
            console.log('GramFrame state update:', state)
          })
        }
      } else {
        bundleStatus.textContent = 'Failed to load'
        bundleStatus.className = 'error'
        loadStatus.textContent = 'GramFrame not available'
        loadStatus.className = 'error'
      }
    })
  </script>
</body>
</html>