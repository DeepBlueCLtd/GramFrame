<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Selection Border Visibility Test</title>
  <link rel="stylesheet" href="src/gramframe.css">
  <style>
    body {
      margin: 20px;
      font-family: Arial, sans-serif;
      background: #2a2a2a;
      color: #fff;
    }
    
    h1 {
      color: #4CAF50;
    }
    
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 4px;
    }
    
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    
    .info {
      color: #2196F3;
      font-style: italic;
    }
    
    #zoom-view {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px;
      background: #333;
      border: 2px solid #555;
      border-radius: 4px;
      max-width: 300px;
    }
    
    #zoom-view h3 {
      margin-top: 0;
      color: #4CAF50;
    }
    
    .border-check {
      margin: 5px 0;
      font-family: monospace;
      font-size: 12px;
    }
    
    .border-visible {
      color: #4CAF50;
    }
    
    .border-hidden {
      color: #ff4444;
    }
  </style>
</head>
<body>
  <h1>Selection Border Visibility Test</h1>
  
  <div id="zoom-view">
    <h3>Border Visibility Check</h3>
    <div class="border-check">Top: <span id="border-top">-</span></div>
    <div class="border-check">Right: <span id="border-right">-</span></div>
    <div class="border-check">Bottom: <span id="border-bottom">-</span></div>
    <div class="border-check">Left: <span id="border-left">-</span></div>
    <hr>
    <p class="info">Green = visible, Red = might be hidden</p>
  </div>
  
  <div class="test-section">
    <h2>What This Tests:</h2>
    <p>This page verifies that the selection border is fully visible on all four sides of a selected table row.</p>
    
    <h3>The Fix:</h3>
    <ul>
      <li class="success">Uses CSS <code>outline</code> instead of <code>border</code> for selection</li>
      <li class="success">Outline sits on top of other elements (won't be hidden)</li>
      <li class="success">Added <code>z-index</code> to ensure selected row is above others</li>
      <li class="success">Enhanced box-shadow for better visibility</li>
    </ul>
    
    <h3>Instructions:</h3>
    <ol>
      <li>Click on the spectrogram to create several markers</li>
      <li>Click on different rows in the markers table</li>
      <li>Check that you can see the green border on ALL sides of the selected row</li>
      <li>The border visibility checker (top right) will analyze the selection</li>
    </ol>
  </div>
  
  <table class="gram-config">
    <tr>
      <td colspan="2">
        <img src="./sample/mock-gram.png" alt="Test Spectrogram">
      </td>
    </tr>
    <tr><td>time-start</td><td>0</td></tr>
    <tr><td>time-end</td><td>60</td></tr>
    <tr><td>freq-start</td><td>0</td></tr>
    <tr><td>freq-end</td><td>20000</td></tr>
  </table>
  
  <script type="module">
    import GramFrame from './src/index.js'
    
    // Border visibility checking
    function checkBorderVisibility() {
      const selectedRow = document.querySelector('.gram-frame-selected-row')
      
      if (selectedRow) {
        const rect = selectedRow.getBoundingClientRect()
        const computedStyle = window.getComputedStyle(selectedRow)
        
        // Check if outline is being applied
        const outline = computedStyle.outline
        const outlineWidth = computedStyle.outlineWidth
        const outlineColor = computedStyle.outlineColor
        const zIndex = computedStyle.zIndex
        
        console.log('Selection styles:', {
          outline,
          outlineWidth,
          outlineColor,
          zIndex,
          position: computedStyle.position
        })
        
        // Simple visibility check based on CSS properties
        const hasOutline = outlineWidth !== '0px' && outline.includes('solid')
        const hasZIndex = zIndex !== 'auto' && parseInt(zIndex) > 0
        
        // Update display
        updateBorderStatus('border-top', hasOutline ? 'Visible (outline)' : 'Check manually', hasOutline)
        updateBorderStatus('border-right', hasOutline ? 'Visible (outline)' : 'Check manually', hasOutline)
        updateBorderStatus('border-bottom', hasOutline ? 'Visible (outline)' : 'Check manually', hasOutline)
        updateBorderStatus('border-left', hasOutline ? 'Visible (outline)' : 'Check manually', hasOutline)
        
        if (!hasOutline) {
          console.warn('Outline might not be applying correctly')
        }
        if (!hasZIndex) {
          console.warn('Z-index might not be set correctly')
        }
      } else {
        // No selection
        updateBorderStatus('border-top', 'No selection', false)
        updateBorderStatus('border-right', 'No selection', false)
        updateBorderStatus('border-bottom', 'No selection', false)
        updateBorderStatus('border-left', 'No selection', false)
      }
    }
    
    function updateBorderStatus(id, text, isVisible) {
      const element = document.getElementById(id)
      if (element) {
        element.textContent = text
        element.className = isVisible ? 'border-visible' : 'border-hidden'
      }
    }
    
    // Check continuously
    setInterval(checkBorderVisibility, 500)
    
    // Auto-create test markers
    setTimeout(() => {
      const gramFrame = window.gramFrameInstances?.[0]
      if (gramFrame && gramFrame.state?.mode === 'analysis' && gramFrame.currentMode) {
        console.log('Creating test markers...')
        
        // Create a grid of markers to test border visibility in different positions
        const markers = [
          { freq: 5000, time: 10 },
          { freq: 10000, time: 20 },
          { freq: 15000, time: 30 },
          { freq: 5000, time: 40 },
          { freq: 10000, time: 50 }
        ]
        
        markers.forEach(pos => {
          gramFrame.currentMode.createMarkerAtPosition(pos)
        })
        
        console.log('Created', markers.length, 'test markers')
        console.log('Click on different table rows to test border visibility')
      }
    }, 1500)
  </script>
</body>
</html>