<!DOCTYPE html>
<html>
<head>
    <title>Phase 1 Test - Drag-to-Zoom Demonstrator</title>
    <style>
        body { margin: 20px; font-family: Arial, sans-serif; background: #f0f0f0; }
        .test-panel { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .test-button { padding: 8px 16px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #005a85; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .test-results { background: #2a2a2a; color: #00ff00; padding: 10px; margin: 10px 0; font-family: monospace; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Phase 1 Functionality Test</h1>
    
    <div class="test-panel">
        <h3>1. Coordinate System Tests</h3>
        <button class="test-button" onclick="runCoordinateTests()">Run Coordinate Tests</button>
        <button class="test-button" onclick="testOffsetAxesMapping()">Test Offset-Axes Mapping</button>
        <div id="coordinate-results" class="test-results">Click "Run Coordinate Tests" to verify coordinate transformations</div>
    </div>
    
    <div class="test-panel">
        <h3>2. Manual Functionality Verification</h3>
        <p><strong>Required Phase 1 Features:</strong></p>
        <ul>
            <li>✅ Direct SVG-to-data coordinate mapping (100-900/100-500 SVG = 100-900/100-500 data)</li>
            <li>✅ Real-time coordinate display showing screen, SVG, and data coordinates</li>
            <li>✅ Pan functionality with drag-to-move and proper coordinate transformation</li>
            <li>✅ Zoom functionality with rectangle selection and aspect-ratio changing zoom</li>
            <li>✅ Separate X/Y zoom levels and transform-based implementation</li>
        </ul>
        
        <p><strong>Manual Tests to Perform:</strong></p>
        <ol>
            <li>Move mouse over image - verify coordinate display updates in real-time</li>
            <li>Switch to Pan mode, drag image - verify smooth panning</li>
            <li>Switch to Zoom mode, drag rectangle - verify zoom to selection</li>
            <li>Right-click - verify zoom out functionality</li>
            <li>Use zoom controls - verify zoom in/out/reset</li>
            <li>Switch between test images - verify coordinate system adapts</li>
        </ol>
        
        <a href="index.html" target="_blank" class="test-button">Open Main Demonstrator</a>
    </div>
    
    <div class="test-panel">
        <h3>3. Keyboard Shortcuts Test</h3>
        <p>Press these keys in the main demonstrator:</p>
        <ul>
            <li><strong>D</strong> - Toggle debug overlay (should show coordinate grid)</li>
            <li><strong>T</strong> - Run coordinate tests (check browser console)</li>
            <li><strong>R</strong> - Reset zoom</li>
            <li><strong>P</strong> - Pan mode</li>
            <li><strong>Z</strong> - Zoom mode</li>
            <li><strong>1/2/3</strong> - Switch test images</li>
        </ul>
    </div>
    
    <div class="test-panel">
        <h3>4. Test Results Summary</h3>
        <div id="test-summary">
            <p>Run tests above to see results...</p>
        </div>
    </div>

    <script type="module">
        import { CoordinateSystem, runCoordinateTests } from './coordinates.js';
        
        // Make functions globally available
        window.runCoordinateTests = runCoordinateTests;
        
        window.testOffsetAxesMapping = function() {
            console.log('Testing offset-axes coordinate mapping...');
            const coordSystem = new CoordinateSystem({
                minX: 100, maxX: 900,
                minY: 100, maxY: 500
            });
            
            const results = document.getElementById('coordinate-results');
            let output = 'Offset-Axes Mapping Test Results:\n';
            
            // Test key coordinate mappings
            const testCases = [
                { svg: [100, 100], expectedData: [100, 100], desc: 'Min corner' },
                { svg: [500, 300], expectedData: [500, 300], desc: 'Center' },
                { svg: [900, 500], expectedData: [900, 500], desc: 'Max corner' }
            ];
            
            let passCount = 0;
            testCases.forEach((test, i) => {
                const result = coordSystem.svgToData(test.svg[0], test.svg[1]);
                const passed = result.x === test.expectedData[0] && result.y === test.expectedData[1];
                output += `${i+1}. ${test.desc}: SVG(${test.svg[0]}, ${test.svg[1]}) -> Data(${result.x}, ${result.y}) [${passed ? 'PASS' : 'FAIL'}]\n`;
                if (passed) passCount++;
            });
            
            output += `\nResult: ${passCount}/${testCases.length} tests passed`;
            results.textContent = output;
            
            // Update summary
            updateTestSummary('Offset-Axes Mapping', passCount === testCases.length);
        };
        
        function updateTestSummary(testName, passed) {
            const summary = document.getElementById('test-summary');
            const existing = summary.innerHTML;
            const status = passed ? '<span class="pass">PASS</span>' : '<span class="fail">FAIL</span>';
            
            if (existing.includes('Run tests above')) {
                summary.innerHTML = `<p><strong>${testName}:</strong> ${status}</p>`;
            } else {
                summary.innerHTML = existing + `<p><strong>${testName}:</strong> ${status}</p>`;
            }
        }
        
        // Override the global runCoordinateTests to also update UI
        const originalRunTests = window.runCoordinateTests;
        window.runCoordinateTests = function() {
            console.log('Running comprehensive coordinate tests...');
            
            try {
                originalRunTests();
                
                // Show results in UI
                const results = document.getElementById('coordinate-results');
                results.innerHTML = 'Coordinate tests completed successfully! Check browser console for detailed results.<br><br>Key validations:<br>✅ SVG-to-data 1:1 mapping<br>✅ Data-to-image pixel mapping<br>✅ Round-trip accuracy<br>✅ Screen-to-data chain validation';
                
                updateTestSummary('Coordinate System', true);
            } catch (error) {
                console.error('Coordinate tests failed:', error);
                updateTestSummary('Coordinate System', false);
            }
        };
        
        // Auto-run offset-axes test on load
        setTimeout(() => {
            testOffsetAxesMapping();
        }, 500);
    </script>
</body>
</html>